{% extends 'layout.html' %}

{% block content %}
	<div id="host">
		<div class="info-banner">
			<h1>Hosting a queue</h1>
		</div>
		<iframe id='player' src="https://embed.spotify.com/?uri=spotify:track:7GhIk7Il098yCjg4BQjzvb&theme=white&view=coverart" width="640" height="80" frameborder="0" allowtransparency="true"></iframe>
		<div class="playlist"></div>
		<div class="bottom-banner">
			<p>Send this link with your friends: <a href="http://{{ip}}:6969/join/{{ip}}" target="_blank">http://{{ip}}:6969/join/{{ip}}</a></p>
		</div>
	</div>
	<script>
		var socket = io.connect('http://{{ip}}:8080');
    socket.on('newTrack', function(data) {
	  var url = 'https://embed.spotify.com/?uri=spotify:track:7GhIk7Il098yCjg4BQjzvb&theme=white&view=coverart';
	  if(data.length > 0) {
		url = 'https://embed.spotify.com/?uri=spotify:trackset:1Q:';
		url += String(data[0].uri).replace(/spotify:track:(.*)/, '$1');
		for (var i = 1; i < data.length; i++) {
		  url += ',' + String(data[i].uri).replace(/spotify:track:(.*)/, '$1');
		}
		url += '&theme=white&view=coverart';
	  }
      $('#player').attr("src", url);
      $(".playlist").append("<p>" + data[data.length-1].name + "</p>").hide().slideDown("slow");
    });

	</script>
{% endblock %}
